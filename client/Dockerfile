FROM node:14-alpine

ARG REACT_APP_AUTHENTICATION_SERVICE_PORT
ARG REACT_APP_COMMON_DATA_SERVICE_PORT
ARG REACT_APP_SEARCH_SUGGESTION_SERVICE_PORT

WORKDIR /usr/src/app

COPY . .
RUN npm install

RUN REACT_APP_AUTHENTICATION_SERVICE_PORT=$REACT_APP_AUTHENTICATION_SERVICE_PORT \
    REACT_APP_COMMON_DATA_SERVICE_PORT=$REACT_APP_COMMON_DATA_SERVICE_PORT \
    REACT_APP_SEARCH_SUGGESTION_SERVICE_PORT=$REACT_APP_SEARCH_SUGGESTION_SERVICE_PORT \
    npm run build

EXPOSE 3000

CMD [ "node", "server.js"]
